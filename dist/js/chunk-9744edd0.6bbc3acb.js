(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9744edd0"],{"1c84":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"startLive"},[s("div",{ref:"liveMain",staticClass:"liveMain",attrs:{id:"liveMain"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.useWB,expression:"useWB"}],ref:"pushDIV",staticClass:"whiteboard"}),s("div",{directives:[{name:"show",rawName:"v-show",value:t.useScreen,expression:"useScreen"}],staticClass:"pushivideoBox",on:{click:t.initScreen}},[s("video",{ref:"pushVideo2",attrs:{id:"pushVideo2",autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),t.iosVideo2&&t.microMessenger?s("div",{staticClass:"playIcon2"}):t._e()]),s("div",{staticClass:"localVideo"},[s("div",{staticClass:"videoContainer",style:t.videoStyle,on:{click:t.initClick}},[s("video",{ref:"pushVideo",attrs:{id:"pushVideo",playsinline:""}}),s("span",[t._v("老师")]),t.oneClickVideo?t._e():s("div",{staticClass:"playIcon"}),t.closeText&&t.clickedToPlay?s("div",{staticStyle:{position:"absolute",width:"100%",top:"45%","font-size":"12px",color:"white"}},[t._v("\n                    等待老师连接....\n                ")]):t._e()]),t.isStudentPushed?s("div",{staticClass:"videoContainer",style:t.videoStyle},[s("video",{ref:"pushtStudentVideo",attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),s("span",[t._v("我")])]):t._e(),t._l(t.useLocalStreamListOnlyStudent,function(e){return s("div",{key:e.stream_id,staticClass:"videoContainer",style:t.videoStyle},[s("video",{ref:e.stream_id,refInFor:!0,attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),s("p",{directives:[{name:"show",rawName:"v-show",value:e.extra_info&&!e.extra_info.video,expression:"student.extra_info && !student.extra_info.video"}],class:[e.extra_info.audio?"onlyAudio":"noAudioVideo"]}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.extra_info&&e.extra_info.video&&!e.extra_info.audio,expression:"student.extra_info && student.extra_info.video && !student.extra_info.audio"}]},[t._v("麦克风未打开")])])})],2),s("div",{class:{control:!0,addWB:t.useWB||t.useScreen}},[s("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"聊天",name:"first"}},[s("div",{staticClass:"chat"},[s("div",{class:{chatBody:!0,chatBodyWeb:t.useWB||t.useScreen},style:{height:!t.isIos&&t.microMessenger?"100%":"calc(100% - 52px)"}},[s("ul",t._l(t.chatList,function(e,i){return s("li",{key:i,class:{me:e.id_name===t.idName,teacher:t.hostIdName===e.id_name}},[e.id_name!==t.idName?s("div",{staticClass:"userName"},[s("p",[s("span",{staticStyle:{color:"#7745FF"}},[t._v(t._s(t.hostIdName!==e.id_name?"学生":"老师")+" ")]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.hostIdName==e.id_name,expression:"hostIdName == chat.id_name"}]},[t._v("：")]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.hostIdName!==e.id_name,expression:"hostIdName !== chat.id_name"}]},[t._v(t._s(e.id_name.substr(e.id_name.length-6)))]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.hostIdName!==e.id_name,expression:"hostIdName !== chat.id_name"}]},[t._v("：")])])]):t._e(),e.id_name==t.idName?s("div",{staticClass:"myColor"},[t._v("我：")]):t._e(),s("div",{staticClass:"userContent"},[s("p",[s("span",[t._v(t._s(e.msg_content))])])])])}),0)]),s("div",{staticClass:"chatFooter"},[s("el-dropdown",{attrs:{trigger:"click",placement:"top-start"},on:{command:t.handleCommand}},[s("span",{staticClass:"studentHandler"}),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:!t.hideLive,expression:"!hideLive"}],staticClass:"studentPush",attrs:{command:"1"}},[s("span",{class:{openPush:!t.isStudentPushed,closePush:t.isStudentPushed}},[t._v("\n                                            "+t._s(t.isStudentPushed?"下讲台":"上讲台")+"\n                                        ")])]),s("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:t.isStudentPushed,expression:"isStudentPushed"}],attrs:{command:"2"}},[s("span",{class:{stOpenAudio:t.stPushAudioOpen,stCloseAudio:!t.stPushAudioOpen}},[t._v("麦克风")])]),s("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:t.isStudentPushed,expression:"isStudentPushed"}],attrs:{command:"3"}},[s("span",{class:{stOpenVideo:t.stPushVideoOpen,stCloseVideo:!t.stPushVideoOpen}},[t._v("摄像头")])]),s("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:!(t.isIos&&t.safari),expression:"!(isIos && safari)"}],attrs:{command:"4"}},[s("span",{class:{openAudio:t.audioOpen,closeAudio:!t.audioOpen}},[t._v("扬声器")])])],1)],1),s("el-input",{attrs:{placeholder:"输入消息参与互动"},model:{value:t.inputMsg,callback:function(e){t.inputMsg=e},expression:"inputMsg"}}),s("el-button",{attrs:{disabled:2!==t.liveStatus||!t.inputMsg||t.allBan},on:{click:t.sendMsg}},[t._v("发送")])],1)])]),s("el-tab-pane",{attrs:{label:"课程信息",name:"second"}},[s("div",{staticClass:"information"},[s("div",{staticClass:"title"},[t._v("考证通直播平台")]),s("div",{staticClass:"clearfix"},[s("span",{staticClass:"roomId"},[t._v("ID: "+t._s(t.roomId))]),s("span",{staticClass:"personNum"},[t._v("共"+t._s(t.userList.length)+"人上课")])])])])],1)],1)])])},o=[],a=s("9ab4"),n=s("60a3"),d=s("050b"),r=s("4bb5"),u=s("c4e7"),h=s("0613"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.unLive=s("5f46"),e.startTime="2019.09.02 10:30",e.title="",e.activeName="first",e.roomId="",e.userId="",e.appId="",e.personNum=222,e.closeText=!1,e.allBan=!1,e.oneClickVideo=!1,e.oneClickVideo2=!1,e.liveStatus=1,e.inputMsg="",e.idName=d["a"].idName,e.isLastOne=!1,e.useWB=!1,e.useScreen=!1,e.isIos=!1,e.iosVideo=!1,e.iosVideo2=!1,e.microMessenger=!1,e.safari=!1,e.initPlay=!0,e.initPlay2=!0,e.clickedToPlay=!1,e.hideLive=!1,e.audioOpen=!0,e.useLocalStreamList=[],e.videoStyle={width:"100vw","padding-left":"0px",height:"100%"},e.isStudentPushed=!1,e.studentPushStreamId="student"+(new Date).getTime(),e.stPushVideoOpen=!0,e.stPushAudioOpen=!0,e}return a["d"](e,t),e.prototype.watchBoolean=function(t){this.closeText=t},e.prototype.watchAllBanBoolean=function(t){1==t?(this.allBan=!0,this.$notify({title:"警告",message:"老师已全员禁言",type:"warning"})):this.allBan=!1},e.prototype.mounted=function(){var t=navigator.userAgent.includes("MicroMessenger"),e=/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent);this.hideLive=t&&e&&"2172413822"===this.$route.query.appId,this.roomId=this.$route.params.roomId,this.isIos=e,this.myBrowser(),this.iosVideo=this.isIos,this.iosVideo2=this.isIos,this.audioOpen=!this.isIos,this.title=this.$route.query.name,this.userId=this.$route.query.userId,this.appId=this.$route.query.appId,this.startLive(),d["a"].play=this.play,d["a"].stopPlay=this.stopPlay,d["a"].onRecvEndJoinLiveCommand=this.onRecvEndJoinLiveCommand,d["a"].onStreamExtraInfoUpdated=this.onStreamExtraInfoUpdated,this.initSound()},e.prototype.beforeDestroy=function(){d["a"].play=function(){},d["a"].stopPlay=function(){},d["a"].onRecvEndJoinLiveCommand=function(){},d["a"].onStreamExtraInfoUpdated=function(){}},e.prototype.testPlay=function(){document.addEventListener("WeixinJSBridgeReady",function(){var t=document.getElementById("pushVideo");t.play()},!1)},e.prototype.stopPlay=function(t,e){var s=this,i=this.useLocalStreamList.findIndex(function(e){return e.stream_id===t.stream_id});this.useLocalStreamList.splice(i,1),this.videoStyleChange(),this.isLastOne=e,console.log("stopPlay",t),this.isLastOne&&setTimeout(function(){s.isLastOne&&s.logOut()},1e4)},e.prototype.startLive=function(){var t=this,e=Number(this.appId);d["a"].login(this.roomId,2,e,this.userId).then(function(e){t.liveStatus=2,0===e.length?t.logOut():(e.forEach(function(e){t.play(e)}),t.setStartStatus(1))},function(e){console.error(e),t.$message({message:"开启直播服务失败了！！网络正常连接下，再刷新页面重试一下吧",type:"warning"})})},e.prototype.play=function(t){var e=this;t.extra_info&&"string"===typeof t.extra_info&&(t.extra_info=JSON.parse(t.extra_info)),this.useLocalStreamList.filter(function(t){return t.stream_id.startsWith("student")}).length<3&&(this.useLocalStreamList.push(t),this.videoStyleChange());var s=t.extra_info;if(t.stream_id.startsWith("screen"))return this.useWB=!1,this.useScreen=!0,void d["a"].pull(this.$refs.pushVideo2,t.stream_id);t.stream_id.startsWith("student")?this.$nextTick(function(){e.$refs[t.stream_id]&&e.$refs[t.stream_id][0]?d["a"].pull(e.$refs[t.stream_id][0],t.stream_id):setTimeout(function(){d["a"].pull(e.$refs[t.stream_id][0],t.stream_id)},1e3),e.toggleAudio(!0)}):(this.useWB=1===s.withWB,this.useScreen=1===s.withScreen,h["a"].commit(u["c"],s.cameraStatus),h["a"].commit(u["b"],s.studentBan),this.useScreen&&(this.useWB=!1),this.useWB?(this.useScreen=!1,this.targetVideo=this.$refs.pushVideo,!d["a"].room&&this.$nextTick(function(){d["a"].joinWB(e.$refs.pushDIV,s.WBJson,!0,!0)})):1===s.withScreen||this.useLocalStreamListOnlyStudent.length>0||this.isStudentPushed?(this.useWB=!1,this.targetVideo=this.$refs.pushVideo):this.targetVideo=this.$refs.pushVideo,this.targetVideo=this.$refs.pushVideo,d["a"].pull(this.targetVideo,t.stream_id),this.oneClickVideo=!1,this.isLastOne=!1,this.hostIdName=t.anchor_id_name)},e.prototype.toggleAudio=function(t){var e=this;void 0===t&&(t=!1),t||(this.audioOpen=!this.audioOpen),!this.isIos&&this.useLocalStreamListOnlyStudent.forEach(function(t){e.$refs[t.stream_id]&&e.$refs[t.stream_id][0]&&(e.$refs[t.stream_id][0].muted=!e.audioOpen)}),!this.isIos&&(this.targetVideo.muted=!this.audioOpen)},Object.defineProperty(e.prototype,"useLocalStreamListOnlyStudent",{get:function(){return this.useLocalStreamList.filter(function(t){return t.stream_id.startsWith("student")})},enumerable:!0,configurable:!0}),e.prototype.videoStyleChange=function(){var t=0;this.useLocalStreamList.forEach(function(e){(e.stream_id.startsWith("stream")||e.stream_id.startsWith("student"))&&++t}),this.isStudentPushed&&++t;var e={width:100/t+"vw","padding-left":"0px",height:"100%"};t>2&&(e["padding-left"]="5px",e.height="50%"),this.videoStyle=e},e.prototype.togglePushStudent=function(){var t=this;this.useLocalStreamListOnlyStudent.length>=3?this.$notify({title:"警告",message:"讲台人数已经超过3人，不能再上讲台",type:"warning"}):this.useLocalStreamList.some(function(t){return t.stream_id.startsWith("stream")})?(this.isStudentPushed=!this.isStudentPushed,this.videoStyleChange(),this.isStudentPushed?this.$nextTick(function(){d["a"].preview(t.$refs.pushtStudentVideo,t.studentPushStreamId,{withWB:0,withScreen:0,WBJson:"",audio:!0,video:!0})}):(d["a"].stopPreview(this.$refs.pushtStudentVideo),d["a"].stopPublish(this.studentPushStreamId))):this.$notify({title:"警告",message:"老师暂时离开，此时不能上讲台",type:"warning"})},e.prototype.sendMsg=function(){this.inputMsg&&(d["a"].sendRoomMsg(this.inputMsg,this.idName),this.setChatInfo([{id_name:this.idName,nick_name:this.idName,role:1,msg_id:"0",msg_category:1,msg_type:1,msg_content:this.inputMsg,send_time:(new Date).getTime()}]),this.inputMsg="",this.$nextTick(function(){document.querySelector(".chatBody").scrollTop=document.querySelector(".chatBody ul li:last-child").offsetTop}))},e.prototype.handleClick=function(t,e){console.log(t,e)},e.prototype.fontSizeChange=function(){},e.prototype.logOut=function(){this.setStartStatus(2),d["a"].leaveRoom(),d["a"].stopWB(),this.$router.push(location.pathname.replace("pull","student")+location.search)},e.prototype.initClick=function(){if(!this.oneClickVideo){var t=document.getElementById("pushVideo");t.play(),this.oneClickVideo=!0,this.isIos&&(this.iosVideo=!1)}},e.prototype.initScreen=function(){if(!this.oneClickVideo2){var t=document.getElementById("pushVideo2");t.play(),this.oneClickVideo2=!0,this.isIos&&(this.iosVideo2=!1)}},e.prototype.created=function(){this.fontSizeChange()},e.prototype.myBrowser=function(){var t=navigator.userAgent;t.indexOf("Opera");t.indexOf("Firefox"),t.indexOf("Chrome"),t.indexOf("Safari")>-1&&(this.safari=!0),t.indexOf("compatible")>-1&&t.indexOf("MSIE"),t.indexOf("wxwork"),t.indexOf("MicroMessenger")>-1&&(this.microMessenger=!0)},e.prototype.initSound=function(){var t=this,e=this.$refs.pushVideo;e.addEventListener("playing",function(){t.$nextTick(function(){e.muted=!1,e.play()})},{once:!1})},e.prototype.handleCommand=function(t){1==t?this.togglePushStudent():2==t?this.toggleStAudio():3==t?this.toggleStVideo():4==t&&this.toggleAudio()},e.prototype.onRecvEndJoinLiveCommand=function(t,e,s,i){this.isStudentPushed&&this.togglePushStudent()},e.prototype.toggleStVideo=function(){this.stPushVideoOpen=!this.stPushVideoOpen,d["a"].toggleVideo(this.stPushVideoOpen),d["a"].updateStreamExtraInfo(this.studentPushStreamId,JSON.stringify({audio:this.stPushAudioOpen,video:this.stPushVideoOpen}))},e.prototype.toggleStAudio=function(){this.stPushAudioOpen=!this.stPushAudioOpen,d["a"].toggleAudio(this.stPushAudioOpen),d["a"].updateStreamExtraInfo(this.studentPushStreamId,JSON.stringify({audio:this.stPushAudioOpen,video:this.stPushVideoOpen}))},e.prototype.onStreamExtraInfoUpdated=function(t){var e=this;this.useLocalStreamList=this.useLocalStreamList.map(function(e){return t.forEach(function(t){e.stream_id===t.stream_id&&(e.extra_info=JSON.parse(t.extra_info))}),e}),t.forEach(function(t){if(t.stream_id.startsWith("stream")){var s=JSON.parse(t.extra_info);"number"===typeof s.withWB&&(0===s.withWB?e.useWB=!1:1===s.withWB&&(e.useWB=!0,!d["a"].room&&e.$nextTick(function(){d["a"].joinWB(e.$refs.pushDIV,s.WBJson,!1,!0)}))),0===s.withScreen&&(e.useScreen=!1)}})},a["c"]([Object(r["b"])("userList")],e.prototype,"userList",void 0),a["c"]([Object(r["b"])("chatList")],e.prototype,"chatList",void 0),a["c"]([Object(r["b"])("cameraStatus")],e.prototype,"cameraStatus",void 0),a["c"]([Object(r["b"])("isAllBan")],e.prototype,"isAllBan",void 0),a["c"]([Object(r["a"])(u["d"])],e.prototype,"setChatInfo",void 0),a["c"]([Object(r["a"])(u["f"])],e.prototype,"setStartStatus",void 0),a["c"]([Object(r["a"])(u["c"])],e.prototype,"setCameraStatus",void 0),a["c"]([Object(n["e"])("cameraStatus")],e.prototype,"watchBoolean",null),a["c"]([Object(n["e"])("isAllBan")],e.prototype,"watchAllBanBoolean",null),e=a["c"]([Object(n["a"])({})],e),e}(n["d"]),l=c,p=l,m=(s("5cb2"),s("2877")),f=Object(m["a"])(p,i,o,!1,null,null,null);e["default"]=f.exports},"5cb2":function(t,e,s){"use strict";var i=s("adec"),o=s.n(i);o.a},"5f46":function(t,e,s){t.exports=s.p+"img/UnliveBg.6edd5470.png"},adec:function(t,e,s){}}]);
//# sourceMappingURL=chunk-9744edd0.6bbc3acb.js.map